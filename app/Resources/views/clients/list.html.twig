{% extends 'base.html.twig' %}
{% block body %}
    <div class="content">
        <table class="table table-striped" id="clients_list">
            <thead>
                <tr>
                    <th></th>
                    <th>
                        <div class="col-md-2">Codigo</div>
                    </th>
                    <th>
                        <div class="col-md-4">Clientes</div>
                        <div class="col-md-8">
                            <input type="text" onkeyup="filter(this)" name="search" id="search" placeholder="Filtro"
                                   class="pull-right"/>
                        </div>
                    </th>

                </tr>
            </thead>
            <tbody>
            {% for client in clients %}
                <tr class="client_row">
                    <td>
                        {% if client.presupuestos|length > 0 %}
                            <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#{{ client.id }}">
                                <span class="glyphicon glyphicon-chevron-down" aria-hidden="true">

                                </span>
                            </button>
                        {% endif %}
                    </td>
                    <td>{{ client.id }}</td>
                    <td>
                        <a href="{{ path('clients_show', {'clientCode': client.id}) }}">{{ client.nombre }}</a>
                    </td>
                    <tr id="{{ client.id }}" class="collapse">

                        <td>Prueba</td>

                        {#<table>#}
                            {#<thead>#}
                            {#<tr>#}
                                {#<th>Presupuesto</th>#}
                                {#<th>Fecha</th>#}
                            {#</tr>#}
                            {#</thead>#}
                            {#<tbody>#}
                                {#{% for presupuesto in client.presupuestos %}#}
                                    {#<tr>#}
                                        {#<td>{{ presupuesto.numero }}</td>#}
                                        {#<td>{{ presupuesto.fecha }}</td>#}
                                    {#</tr>#}

                                {#{% endfor %}#}
                            {#</tbody>#}
                        {#</table>#}

                    </tr>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    {#Function for filtering lists#}
    <script language="javascript" type="text/javascript">
        function filter(element) {

            var count = 0;
            var value = $(element).val();
            value = value.toUpperCase();
            console.log(value);

            $(".client_row").each(function () {
                text = $(this)
                        .text()
                        .replace(/(\r\n|\n|\r)/gm, "")
                        .toString()
                        .trim()
                        .toUpperCase();
                console.log(text);
                if (text.search(value) > -1) {
                    $(this).show();
                    count++;
                    $("input[name='list_matched']").show();
                }
                else {
                    $(this).hide();
                }
            });


//            value = value.toLowerCase().replace(/\b[a-z]/g, function(letter) {
//                return letter.toUpperCase();
//            });
//
//            $(".client_row").each(function() {
//                text = $(this).text().replace(/(\r\n|\n|\r)/gm,"").trim();
//                text = text.toUpperCase()
//                console.log(text);
//                console.log(value);
//                if (text.search(value) > -1) {
//                    $(this).show();
//                    count++;
//                    $("input[name='list_matched']").show();
//                }
//                else {
//                    $(this).hide();
//                }
//            });
//
//            $("input[name='list_matched']").val(count);
//
        }
    </script>

{% endblock %}